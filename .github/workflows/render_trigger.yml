name: Run fcanews every 2 hours on the hour (KST)

on:
  schedule:
    # KST 기준 정시 (00, 02, 04, ..., 22)
    - cron: "0 15,17,19,21,23,1,3,5,7,9,11,13 * * *"
  workflow_dispatch:

jobs:
  run_fcanews:
    runs-on: ubuntu-latest
    steps:
      - name: Wake Render instance
        run: |
          curl -s -X POST "https://api.render.com/v1/services/${{ secrets.RENDER_SERVICE_ID }}/resume" \
            -H "Authorization: Bearer ${{ secrets.RENDER_API_KEY }}" || true

      - name: Wait for Render warmup
        run: sleep 60

      - name: Trigger deploy
        run: |
          curl -s -X POST "https://api.render.com/v1/services/${{ secrets.RENDER_SERVICE_ID }}/deploys" \
            -H "Authorization: Bearer ${{ secrets.RENDER_API_KEY }}"

      - name: Keep alive for 5 minutes
        run: sleep 300

      - name: Suspend instance
        run: |
          curl -s -X POST "https://api.render.com/v1/services/${{ secrets.RENDER_SERVICE_ID }}/suspend" \
            -H "Authorization: Bearer ${{ secrets.RENDER_API_KEY }}"
